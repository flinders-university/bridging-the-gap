<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Survey Report</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600,700" rel="stylesheet">
    <style>
      body { font-family: 'Open Sans', sans-serif; font-size: 14px; }
      hr {
        -webkit-box-sizing: content-box;
           -moz-box-sizing: content-box;
                box-sizing: content-box;
        height: 0;
      }
      hr {
        margin-top: 20px;
        margin-bottom: 20px;
        border: 0;
        border-top: 1px solid #eeeeee;
      }
      .page-break {
        page-break-before: always;
      }
      .page-break:last-child {
        page-break-before: avoid;
      }
      .question {
        border: 1px solid lightgrey;
        border-radius: 2px;
        padding: 5px;
        margin-bottom: 10px;
        background: url(<%= image_url("question.svg") %>) no-repeat top right;
        background-size: 90px;
        -webkit-print-color-adjust: exact;
        page-break-before: always;
      }
      table {
        border-collapse: collapse;
        border-spacing: 0;
      }
      td,
      th {
        padding: 0;
      }
      table {
        background-color: transparent;
      }
      caption {
        padding-top: 8px;
        padding-bottom: 8px;
        color: #777777;
        text-align: left;
      }
      th {
        text-align: left;
      }
      .table {
        width: 100%;
        max-width: 100%;
        margin-bottom: 20px;
      }
      .table > thead > tr > th,
      .table > tbody > tr > th,
      .table > tfoot > tr > th,
      .table > thead > tr > td,
      .table > tbody > tr > td,
      .table > tfoot > tr > td {
        padding: 8px;
        line-height: 1.42857143;
        vertical-align: top;
        border-top: 1px solid #dddddd;
      }
      .table > thead > tr > th {
        vertical-align: bottom;
        border-bottom: 2px solid #dddddd;
      }
      .table > caption + thead > tr:first-child > th,
      .table > colgroup + thead > tr:first-child > th,
      .table > thead:first-child > tr:first-child > th,
      .table > caption + thead > tr:first-child > td,
      .table > colgroup + thead > tr:first-child > td,
      .table > thead:first-child > tr:first-child > td {
        border-top: 0;
      }
      .table > tbody + tbody {
        border-top: 2px solid #dddddd;
      }
      .table .table {
        background-color: #ffffff;
      }
      .table-condensed > thead > tr > th,
      .table-condensed > tbody > tr > th,
      .table-condensed > tfoot > tr > th,
      .table-condensed > thead > tr > td,
      .table-condensed > tbody > tr > td,
      .table-condensed > tfoot > tr > td {
        padding: 5px;
      }
      .table-bordered {
        border: 1px solid #dddddd;
      }
      .table-bordered > thead > tr > th,
      .table-bordered > tbody > tr > th,
      .table-bordered > tfoot > tr > th,
      .table-bordered > thead > tr > td,
      .table-bordered > tbody > tr > td,
      .table-bordered > tfoot > tr > td {
        border: 1px solid #dddddd;
      }
      .table-bordered > thead > tr > th,
      .table-bordered > thead > tr > td {
        border-bottom-width: 2px;
      }
      .table-striped > tbody > tr:nth-of-type(odd) {
        background-color: #f9f9f9;
      }
      .table-hover > tbody > tr:hover {
        background-color: #f5f5f5;
      }
      table col[class*="col-"] {
        position: static;
        float: none;
        display: table-column;
      }
      table td[class*="col-"],
      table th[class*="col-"] {
        position: static;
        float: none;
        display: table-cell;
      }
      .table > thead > tr > td.active,
      .table > tbody > tr > td.active,
      .table > tfoot > tr > td.active,
      .table > thead > tr > th.active,
      .table > tbody > tr > th.active,
      .table > tfoot > tr > th.active,
      .table > thead > tr.active > td,
      .table > tbody > tr.active > td,
      .table > tfoot > tr.active > td,
      .table > thead > tr.active > th,
      .table > tbody > tr.active > th,
      .table > tfoot > tr.active > th {
        background-color: #f5f5f5;
      }
      .table-hover > tbody > tr > td.active:hover,
      .table-hover > tbody > tr > th.active:hover,
      .table-hover > tbody > tr.active:hover > td,
      .table-hover > tbody > tr:hover > .active,
      .table-hover > tbody > tr.active:hover > th {
        background-color: #e8e8e8;
      }
      .table > thead > tr > td.success,
      .table > tbody > tr > td.success,
      .table > tfoot > tr > td.success,
      .table > thead > tr > th.success,
      .table > tbody > tr > th.success,
      .table > tfoot > tr > th.success,
      .table > thead > tr.success > td,
      .table > tbody > tr.success > td,
      .table > tfoot > tr.success > td,
      .table > thead > tr.success > th,
      .table > tbody > tr.success > th,
      .table > tfoot > tr.success > th {
        background-color: #dff0d8;
      }
      .table-hover > tbody > tr > td.success:hover,
      .table-hover > tbody > tr > th.success:hover,
      .table-hover > tbody > tr.success:hover > td,
      .table-hover > tbody > tr:hover > .success,
      .table-hover > tbody > tr.success:hover > th {
        background-color: #d0e9c6;
      }
      .table > thead > tr > td.info,
      .table > tbody > tr > td.info,
      .table > tfoot > tr > td.info,
      .table > thead > tr > th.info,
      .table > tbody > tr > th.info,
      .table > tfoot > tr > th.info,
      .table > thead > tr.info > td,
      .table > tbody > tr.info > td,
      .table > tfoot > tr.info > td,
      .table > thead > tr.info > th,
      .table > tbody > tr.info > th,
      .table > tfoot > tr.info > th {
        background-color: #d9edf7;
      }
      .table-hover > tbody > tr > td.info:hover,
      .table-hover > tbody > tr > th.info:hover,
      .table-hover > tbody > tr.info:hover > td,
      .table-hover > tbody > tr:hover > .info,
      .table-hover > tbody > tr.info:hover > th {
        background-color: #c4e3f3;
      }
      .table > thead > tr > td.warning,
      .table > tbody > tr > td.warning,
      .table > tfoot > tr > td.warning,
      .table > thead > tr > th.warning,
      .table > tbody > tr > th.warning,
      .table > tfoot > tr > th.warning,
      .table > thead > tr.warning > td,
      .table > tbody > tr.warning > td,
      .table > tfoot > tr.warning > td,
      .table > thead > tr.warning > th,
      .table > tbody > tr.warning > th,
      .table > tfoot > tr.warning > th {
        background-color: #fcf8e3;
      }
      .table-hover > tbody > tr > td.warning:hover,
      .table-hover > tbody > tr > th.warning:hover,
      .table-hover > tbody > tr.warning:hover > td,
      .table-hover > tbody > tr:hover > .warning,
      .table-hover > tbody > tr.warning:hover > th {
        background-color: #faf2cc;
      }
      .table > thead > tr > td.danger,
      .table > tbody > tr > td.danger,
      .table > tfoot > tr > td.danger,
      .table > thead > tr > th.danger,
      .table > tbody > tr > th.danger,
      .table > tfoot > tr > th.danger,
      .table > thead > tr.danger > td,
      .table > tbody > tr.danger > td,
      .table > tfoot > tr.danger > td,
      .table > thead > tr.danger > th,
      .table > tbody > tr.danger > th,
      .table > tfoot > tr.danger > th {
        background-color: #f2dede;
      }
      .table-hover > tbody > tr > td.danger:hover,
      .table-hover > tbody > tr > th.danger:hover,
      .table-hover > tbody > tr.danger:hover > td,
      .table-hover > tbody > tr:hover > .danger,
      .table-hover > tbody > tr.danger:hover > th {
        background-color: #ebcccc;
      }
      .table-responsive {
        overflow-x: auto;
        min-height: 0.01%;
      }
      .table-striped > tbody > tr:nth-of-type(odd) {
        background-color: #f9f9f9;
      }
      .table-hover > tbody > tr:hover {
        background-color: #f5f5f5;
      }
    </style>
  </head>
  <body>
    <h1 style="margin-bottom: -6px; margin-top: 4px;">Survey Data Report</h1>
    <p><em>Updated: <%= Date.today.strftime("#{Date.today.day.ordinalize} of %B %Y") %></em></p>
    <p style="font-size: 12px;">Student information is <strong>strictly confidential</strong> and its use is governed by the University policy on Access to Student Information.</p>

    <hr>
    <% @surveys.each do |survey| %>
    <div class="survey">
      <h2 style="margin-bottom: -12px;"><%= survey.title %></h2>
      <p>for <%= survey.group.name %>.</p><p><strong>Coding:</strong></p>
      <%= mdrender(survey.coding_explanation).html_safe %>

      <p><strong>Participant Summary</strong></p>
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Degree</th>
            <th>STEM Interest</th>
            <th>Gender</th>
            <th>Age</th>
          </tr>
        </thead>
        <tbody>
          <% @users.each do |user| %>
          <%= "<tr><td>#{@users[user.first].name}</td><td>#{@users[user.first].email}</td><td>#{if !@users[user.first].degree.present? then "<font color='red'>missing</font>" else @users[user.first].degree end}</td><td>#{if !@users[user.first].major.present? then "<font color='red'>missing</font>" else @users[user.first].major end}</td><td>#{if !@users[user.first].gender.present? then "<font color='red'>missing</font>" else @users[user.first].gender end}</td><td>#{if !@users[user.first].age.present? then "<font color='red'>missing</font>" else @users[user.first].age end}</td></tr>".html_safe %>
          <% end %>
        </tbody>
      </table>

      <% survey.i_questions.order(:order).each do |question| %>
        <div class="question question-<%= question.id %>">
          <p><em>Q<%= question.order %>.</em> <strong><%= question.description %></strong>:
          <br>Question id: <%= question.id %>&nbsp;&nbsp;&nbsp;&nbsp; Survey: <%= question.i_survey_id %>&nbsp;&nbsp;&nbsp;&nbsp; Group Code: <%= question.grouping_value %>&nbsp;&nbsp;&nbsp;&nbsp; Answers: <%= @answers.where(:survey_id => survey.id, :question_id => question.id).count %></p>

          <% @answers.where(:survey_id => survey.id, :question_id => question.id).each do |answer| %>
          <div class="answer">
            <% @users[answer.user_id] ||= User.find_by_id(answer.user_id) %>
            <div class="response">
              <p><strong><%= @users[answer.user_id].name %> ~></strong> <span style="padding-right: 50px;"></span><%= answer.answer %> <br>
              <em>Answered: <%= answer.updated_at.strftime("%d/%m/%y %I:%M %p") %> Question: <%= answer.question_id %> Survey: <%= answer.survey_id %></em></p>
            </div>
          </div>
          <% end %>
        </div>
      <% end %>
    </div>
    <% end %>
  </body>
</html>
